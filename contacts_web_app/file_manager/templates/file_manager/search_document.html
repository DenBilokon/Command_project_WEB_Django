{% extends 'users/base.html' %}
{% load static %}

{% block content %}
<div class="text-center">
    <a href="{% url 'file_manager:upload_picture' %}" class="btn btn-primary" style="width: 24%">Pictures</a>
    <a href="{% url 'file_manager:upload_video' %}" class="btn btn-primary" style="width: 24%">Video</a>
    <a href="{% url 'file_manager:upload_audio' %}" class="btn btn-primary" style="width: 24%">Audio</a>
    <a href="{% url 'file_manager:upload_document' %}" class="btn btn-primary" style="width: 24%">Documents</a>
</div>
<br>
<h1>Search results: {{ query }}</h1>
<br>
<h2 class="text-center">Cloud Document</h2>
<br>
<div class="d-flex justify-content-center align-items-center mx-auto">
    <form class="d-flex search-form" action="{% url 'file_manager:search_document' %}" method="get">
        <input class="form-control me-2" type="search" name="q" placeholder="Search" aria-label="Search">
        <button class="btn btn-primary" type="submit">Search</button>
    </form>
</div>
<br>
{% if form.errors %}
<span class="alert alert-danger" role="alert">{{form.non_field_errors}}</span>
{% endif %}

{% if messages %}
<div>
    {% for message in messages %}
    <div {% if message.tags %} class="alert alert-{{ message.tags }}" {% endif %} role="alert">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}
<br>
{% csrf_token %}
{% if not cloud_document %}
<div>Not found "{{query}}"</div>
{% endif %}
<br>
<div>
    <ul class="document-list">
        {% for document in cloud_document %}
        <li class="document-item">
            <div class="document-details">
                <div class="document-title">{{ document.title|truncatechars:50 }}</div>
            </div>
            <div class="document-actions">
                <button class="badge rounded-pill bg-light download-document-button"
                        onclick="window.location.href='{{ document.document.url }}'">Download
                </button>
                <button class="badge rounded-pill bg-dark delete-document-button" data-document-id="{{ document.id }}">
                    Delete
                </button>
            </div>
        </li>
        {% empty %}
        <li>
            <h2 class="text-center">No available documents.</h2>
        </li>
        {% endfor %}
    </ul>
</div>

<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Document Deletion</h5>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this Document?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cancelDeleteButton">Cancel
                </button>

            </div>
        </div>
    </div>
</div>
<br>
<div>
    <ul class="pagination pagination-lg">
        <li class="page-item {% if not cloud_document.has_previous %}disabled{% endif %}">
            <a class="page-link" href="{% if cloud_document.has_previous %}?page=1{% else %}#{% endif %}">&laquo;</a>
        </li>
        {% for num in cloud_document.paginator.page_range %}
        {% if num == cloud_document.number %}
        <li class="page-item active">
            <a class="page-link" href="#">{{ num }}</a>
        </li>
        {% elif num > cloud_document.number|add:'-2' and num < cloud_document.number|add:'3' %}
        <li class="page-item">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
        {% endif %}
        {% endfor %}
        <li class="page-item {% if not cloud_document.has_next %}disabled{% endif %}">
            <a class="page-link"
               href="{% if cloud_document.has_next %}?page={{ cloud_document.paginator.num_pages }}{% else %}#{% endif %}">&raquo;</a>
        </li>
    </ul>
</div>
<br>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    var deleteDocumentId;

    $(".delete-document-button").on("click", function() {
        deleteDocumentId = $(this).data("document-id");
        $("#confirmDeleteModal").modal("show");
    });

    $("#confirmDeleteButton").on("click", function() {
        deleteDocument(deleteDocumentId);
    });

    function deleteDocument(documentId) {
        var deleteDocumentUrl = "{% url 'file_manager:delete_document' document_id=0 %}".replace("0", documentId);
        window.location.href = deleteDocumentUrl;
    }

    $("#cancelDeleteButton").on("click", function() {
        $("#confirmDeleteModal").modal("hide");
    });
});
</script>

<style>
.document-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.document-title {
    flex-grow: 1;
}

.document-actions {
    margin-left: 10px;
}
</style>
{% endblock %}